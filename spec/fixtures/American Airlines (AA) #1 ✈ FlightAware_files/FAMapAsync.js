
var FAMapAsync=new function(){this.loaded=false;this.loadTriggered=false;this.instances={};this.pendingDeps=0;this.factory=function(dom_id,options){if(this.loaded){return FAMap.factory.apply(window,arguments);}else if(!this.loadTriggered){this.triggerLoad();}
this.instances[dom_id]={target:dom_id,options:options,deferred:$.Deferred(),loaded:false};return this.instances[dom_id].deferred.promise();};this.triggerLoad=function(){this.loadTriggered=true;$body=$('body');$.each(FAMap_URLs,$.proxy(function(k,dep){if(dep.type==='js'){var $tag=$('<script>').on('load',$.proxy(this.onDepLoaded,this))
$body.append($tag);$tag.attr('src',dep.url);}else if(dep.type==='css'){var $tag=$('<link>').attr({rel:'stylesheet',type:'text/css',href:dep.url}).on('load',$.proxy(this.onDepLoaded,this));$body.append($tag);}else{return true;}
this.pendingDeps++;},this));};this.onDepLoaded=function(){this.pendingDeps--;if(this.pendingDeps==0){this.onAllDepsLoaded();}};this.onAllDepsLoaded=function(){this.loaded=true;$.each(this.instances,$.proxy(function(k,instance){if(instance.loaded){return true;}
FAMap.factory(instance.target,instance.options);FAMap.getInstance(instance.target).done($.proxy(function(mapObj){this.instances[k].deferred.resolve(mapObj);},this));this.instances[k].loaded=true;},this));};this.getInstance=function(id){if(id in this.instances){return this.instances[id].deferred.promise();}else{throw'Error: no known FAMap instance for '+id;}};};var FAMap=FAMapAsync;var mapGlobals=mapGlobals||{};FAMap.Util={getNow:function(){return FADate.getNow();}};