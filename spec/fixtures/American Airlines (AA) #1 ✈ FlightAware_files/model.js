var fakeMap=new function(){this._data={};this.$el=$('<div>');this.on=function(event,handler){this.$el.on(event,handler);if(event==='animationFlight.flightDataChange'&&this._lastBatch!==null){this.dataReceived(this.getSyntheticBatch());}};this.trigger=function(event,extra){this.$el.trigger(event,extra);};this.disable=function(){this.poller.stopPolling();delete this.poller;};this.getSyntheticBatch=function(){var retval=[];$.each(this._data,function(flight_id,flightData){retval.push({flight_id:flight_id,flightData:flightData})});return retval;};this.dataReceived=$.proxy(function(batch){$.each(batch,$.proxy(function(k,v){this.trigger('animationFlight.flightDataChange',[v.flightData]);this._data[v.flight_id]=v.flightData;},this));},this);var pollerOptions={onNewFlights:this.dataReceived,onUpdatedFlights:this.dataReceived};this.poller=new TrackPollClient({options:{}},pollerOptions);};var FlightPageModel=new function(){this._data=null;this._map=null;this.$el=$('<div>');this.noRefresh=/norefresh/.test(window.location.href);this.on=function(event,handler){this.$el.on(event,handler);};this.trigger=function(event,extra){this.$el.trigger(event,extra);};this.setMap=function(map){if(this._map!==null){if('disable'in this._map&&typeof this._map.disable==='function'){this._map.disable();}
delete this._map;}
this._map=map;this._map.on('animationFlight.flightDataChange',$.proxy(function(e,data){if(this._data!==null&&(!('unknown'in this._data)||!this._data.unknown)&&!this._data.blockedForUser){if((this._data.flightId!==data.flightId||this._data.destination.icao!==data.destination.icao)&&!this.noRefresh){window.location.href=window.location.href;}}
this._data=data;this.trigger('dataUpdate',[data]);},this));};this.debug=function(data){this.noRefresh=true;this.setMap(data);}
this.getData=function(){return this._data;}
this.refresh=function(){if(this._map.poller){this._map.poller.poll();}else{this._map._animationController._poller.poll();}}
this.setMap(fakeMap);};